<div
  class="flex flex-col"
  *transloco="let t; prefix: 'transfer.charity.form'">
  <main class="bg-page pb-3xl flex-grow">
    @if (transfer.step() === 'form') {
      <form
        class="page-grid p-0"
        *transloco="let t; prefix: 'transfer.form'">
        <div class="gap-2xl col-span-12 flex flex-col 2xl:col-span-10 2xl:col-start-2">
          <scb-card class="p-xl gap-2xl flex flex-col">
            <div class="gap-lg flex flex-col">
              <p class="mf-lg font-semibold">{{ t('from') }}</p>
              <select-account-field
                type="from"
                transferType="CHARITY"
                currency="EGP"
                [setAccountData]="this.repeatTransferData()?.fromAccount"
                [isLoadingState]="transfer.fromAccountsLoading()"
                [accountsData]="transfer.fromAccountsData()"
                [errorState]="transfer.fromAccountsError()"
                [availableCurrencies]="transfer.getAvailableCurrencies('from')"
                (accountSelected)="handleAccountSelected($event)"
                (refreshRequest)="handleRefreshRequest($event)" />
              @if (fromAccount.touched && fromAccount.invalid) {
                <p class="mf-sm text-input-text-danger gap-sm flex items-start">
                  <icon
                    name="info-circle"
                    class="w-[18px] flex-none" />
                  {{ t('sectionRequired') }}
                </p>
              }
            </div>

            <div class="gap-lg flex flex-col">
              <p
                class="mf-lg font-semibold"
                *transloco="let t; prefix: 'transfer.charity'">
                {{ t('charity') }}
              </p>
              <charity-field
                [preselectedCharity]="selectedCharity()"
                (charitySelected)="onCharitySelected($event)" />

              @if (selectedCharity()) {
                <charity-categories
                  [customerId]="selectedCharity()!.customerId"
                  [charityTransferDto]="$any(form.get('charityTransferDto')?.value)"
                  (categorySelected)="onCategorySelected($event)" />
              }

              @if (form.get('charityTransferDto')?.touched && form.get('charityTransferDto')?.invalid) {
                <p class="mf-sm text-input-text-danger gap-sm flex items-start">
                  <icon
                    name="info-circle"
                    class="w-[18px] flex-none" />
                  {{ t('sectionRequired') }}
                </p>
              }
            </div>

            <div class="gap-lg flex flex-col">
              <p class="mf-lg font-semibold">{{ t('amount') }}</p>
              <app-currency-flag-field
                [currency]="transferCurrency.value"
                [control]="currencyField" />

              <transfer-description-field
                [control]="descriptionField"
                [scbMaxLength]="300"
                [showDesc]="!!repeatTransferData()?.description?.trim()" />
            </div>
          </scb-card>
        </div>
      </form>
    }

    @if (transfer.step() === 'summary' || transfer.step() === 'otp') {
      <transaction-summary />
    }

    @if (transfer.step() === 'success') {
      <transaction-success />
    }
  </main>

  <submit-buttons-footer [form]="form" />
</div>
