@if (status() === 'loading') {
  <scb-table-skeleton
    [rows]="5"
    [columns]="4" />
} @else if (status() === 'error') {
  <div
    *transloco="let t; prefix: 'dashboard'"
    class="py-3xl sm:px-3xl col-span-12 flex w-full flex-col items-center justify-center gap-3 px-4 text-center"
    data-testid="accounts_div_errorState">
    <icon
      [name]="'api-failure'"
      class="text-3xl"
      data-testid="accounts_icon_apiFailure" />
    <h4
      class="head-2xs-s text-text-primary"
      data-testid="accounts_h4_apiError">
      {{ t('error.apiError') }}
    </h4>
    <p
      class="body-sm text-text-primary"
      data-testid="accounts_p_apiErrorDetail">
      {{ t('error.apiErrorDetail') }}
    </p>
    <button
      scbButton
      variant="ghost"
      size="sm"
      icon="refresh"
      (click)="idcResource.reload()"
      data-testid="accounts_button_reload">
      {{ t('error.reload') }}
    </button>
  </div>
} @else {
  <div
    *transloco="let t; prefix: 'facilities.facilitiesIdc'"
    class="border-border-secondary py-xl gap-lg flex flex-col rounded-4xl border-1">
    <!-- Title and Download Statement Button -->
    <div class="gap-sm px-xl flex flex-col sm:flex-row sm:items-center sm:justify-between">
      <p
        class="mf-lg font-semibold"
        data-testid="IDC_TITLE">
        {{ t('title') }}
      </p>

      <div data-testid="IDC_DOWNLOAD_CONTAINER">
        <button
          scbButton
          size="lg"
          [disabled]="isEmpty()"
          icon="statement-download"
          (click)="downloadOptionsMenu.toggle($event)"
          type="button"
          class="mf-md"
          data-testid="IDC_DOWNLOAD_BUTTON">
          {{ t('downloadStatement') }}
        </button>

        <p-menu
          #downloadOptionsMenu
          [model]="downloadOptionsList"
          [popup]="true"
          data-testid="IDC_DOWNLOAD_MENU">
          <ng-template
            #item
            let-item>
            <div
              tabindex="0"
              class="flex flex-1 gap-3"
              (click)="download(item.icon)"
              role="button"
              data-testid="IDC_DOWNLOAD_OPTION">
              <icon
                class="w-2xl"
                [name]="item.icon"
                data-testid="IDC_DOWNLOAD_OPTION_ICON"></icon>
              <p
                class="mf-md text-text-primary flex-1"
                data-testid="IDC_DOWNLOAD_OPTION_LABEL">
                {{ item.label }}
              </p>
              <icon
                class="text-text-brand w-2xl"
                name="download"
                data-testid="IDC_DOWNLOAD_OPTION_DOWNLOAD_ICON"></icon>
            </div>
          </ng-template>
        </p-menu>
      </div>
    </div>

    <!-- Filter Section -->
    @if (!isEmpty() || idcTypeValue().length) {
      <div class="gap-md mb-4 flex flex-col px-4 sm:flex-row sm:items-center">
        <p
          class="mf-md text-text-secondary font-medium"
          data-testid="ACCOUNT_TRANSACTION_FILTER_BY">
          {{ t('filterBy') }}
        </p>

        <div class="gap-md flex items-center">
          <scb-form-field
            [variant]="idcTypeValue().length ? 'primary' : 'ghost'"
            data-testid="IDC_FORM_FIELD_STATUS">
            <scb-select
              #idcTypeSelect
              [(value)]="idcTypeValue"
              multiple
              [options]="idcLookupTypes()"
              [filterFn]="filterIdcType"
              data-testid="IDC_SELECT_STATUS_VALUE"
              [searchPlaceholder]="t('searchOptions')"
              noAutoClose>
              <app-select-value
                scbSelectTrigger
                [placeholder]="t('filterPlaceholder')"
                data-testid="IDC_SELECT_TRIGGER"
                [len]="idcTypeValue().length" />
              @for (item of idcTypeSelect.optionsFilter.filteredList(); track item.key) {
                <scb-option
                  [value]="item.key"
                  class="capitalize">
                  {{ item.value }}
                </scb-option>
              }
              <app-select-footer
                class="select-footer"
                (apply)="applyFilter()"
                (resetValue)="idcTypeValue.set([])" />
            </scb-select>
          </scb-form-field>

          @if (idcTypeValue().length) {
            <button
              scbButton
              variant="secondary"
              size="md"
              (click)="clearFilter()"
              class="!px-2"
              data-testid="IDC_CLEAR_FILTER_BUTTON">
              {{ t('clearFilter') }}
            </button>
          }
        </div>
      </div>
    }

    <!-- Empty state & Table -->
    @if (isEmpty()) {
      <div
        data-testid="IDC_EMPTY_STATE"
        class="emptyState flex w-full flex-col items-center justify-center text-center">
        <icon
          [name]="'not-found'"
          data-testid="IDC_EMPTY_STATE_ICON"
          class="text-3xl" />
        <h4
          data-testid="IDC_EMPTY_STATE_TITLE"
          class="mt-sm mb-sm mf-2xl font-semibold">
          {{ t('empty.title') }}
        </h4>
        <p
          data-testid="IDC_EMPTY_STATE_SUBTITLE"
          class="text-text-tertiary text-sm-sm">
          {{ t('empty.subTitle') }}
        </p>
      </div>
    } @else {
      <p-table
        [value]="idcList().idcList"
        [paginator]="false"
        [rows]="rows()"
        [first]="first()"
        [totalRecords]="totalRecords()"
        data-testid="IDC_TABLE">
        <ng-template #header>
          <tr>
            <th
              class="mf-sm !font-medium"
              data-testid="IDC_TABLE_HEADER_IDC_NUMBER">
              {{ t('table.idcNumber') }}
            </th>
            <th
              class="mf-sm !font-medium"
              data-testid="IDC_TABLE_HEADER_IDC_TYPE">
              {{ t('table.idcType') }}
            </th>
            <th
              class="mf-sm !font-medium"
              data-testid="IDC_TABLE_HEADER_IDC_AMOUNT">
              {{ t('table.idcAmount') }}
            </th>
            <th
              class="mf-sm !font-medium"
              data-testid="IDC_TABLE_HEADER_IDC_DRAWER">
              {{ t('table.idcDrawer') }}
            </th>
            <th
              class="mf-sm !font-medium"
              data-testid="IDC_TABLE_HEADER_DUE_DATE">
              {{ t('table.dueDate') }}
            </th>
          </tr>
        </ng-template>
        <ng-template
          #body
          let-idc>
          <tr
            (click)="navigateToDetails(idc.idcNumber)"
            (keydown.enter)="navigateToDetails(idc.idcNumber)"
            class="focus:ring-primary cursor-pointer transition-colors duration-200 hover:bg-gray-50 focus:ring-2 focus:outline-none focus:ring-inset dark:hover:bg-gray-800"
            tabindex="0"
            role="button"
            [attr.aria-label]="'View details for IDC ' + idc.idcNumber"
            [attr.data-testid]="'idc_row_' + idc.idcNumber"
            [attr.data-idc-number]="idc.idcNumber">
            <td class="mf-sm text-text-primary font-normal">
              {{ idc.idcNumber }}
            </td>
            <td class="mf-sm text-text-primary font-normal">
              {{ idc.idcTypeDescription }}
            </td>
            <td>
              <currency-view
                [amount]="idc.idcAmount"
                [currency]="idc.idcCurrency"
                size="sm"
                emptyValue="â€“" />
            </td>
            <td>
              <p class="mf-sm text-text-primary ltr-force font-semibold rtl:text-right">
                {{ idc.idcDrawer }}
              </p>
            </td>
            <td>
              <date-view
                data-testid="DASH_CERTIFICATE_BASIC_DETAIL_TITLE"
                [value]="idc.dueDate"
                variant="sm" />
            </td>
          </tr>
        </ng-template>
      </p-table>
    }
  </div>

  <!-- Pagination -->
  @if (!isEmpty()) {
    <div
      *transloco="let t; prefix: 'facilities.facilitiesLgs'"
      class="table-footer pt-2xl flex flex-col items-center justify-between max-sm:justify-center sm:flex-row">
      <div class="page-info-container">
        <span class="mf-sm text-text-secondary hidden font-normal sm:block">
          {{ t('page') }} {{ pageNumber() + 1 }} {{ t('pageOf') }} {{ totalPages() }}</span
        >
      </div>
      <div class="pagination-container">
        <p-paginator
          [first]="first()"
          [rows]="rows()"
          [totalRecords]="totalRecords()"
          [showCurrentPageReport]="false"
          [showFirstLastIcon]="!layoutFacade.mobileMode()"
          (onPageChange)="onPageChange($event)">
          <ng-template #firstpagelinkicon>
            <icon
              class="h-3xl w-3xl"
              name="arrow-left-double" />
          </ng-template>
          <ng-template #previouspagelinkicon>
            <icon
              class="h-3xl w-3xl"
              name="arrow-left" />
          </ng-template>
          <ng-template #lastpagelinkicon>
            <icon
              class="h-3xl w-3xl"
              name="arrow-right-double" />
          </ng-template>
          <ng-template #nextpagelinkicon>
            <icon
              class="h-3xl w-3xl"
              name="arrow-right" />
          </ng-template>
        </p-paginator>
      </div>

      @if (!layoutFacade.mobileMode()) {
        <div class="mf-md text-text-secondary hidden sm:block">
          <p-select
            [options]="paginationSizeOptions()"
            (onChange)="onPageSizeChange($event)"
            optionLabel="label"
            optionValue="value"
            [appendTo]="lang() === 'ar' ? null : 'body'"
            (ngModelChange)="first.set(0)"
            [(ngModel)]="rows">
            <ng-template pTemplate="selectedItem">
              <div class="align-items-center flex gap-2">
                <div>{{ rows() }} {{ t('perPage') }}</div>
              </div>
            </ng-template>

            <ng-template
              let-country
              pTemplate="item">
              <div class="align-items-center flex gap-2">
                <div>{{ country.label }} {{ t('perPage') }}</div>
              </div>
            </ng-template>
          </p-select>
        </div>
      }
    </div>
  }
}
